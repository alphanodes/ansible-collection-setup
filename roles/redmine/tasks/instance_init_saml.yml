---

- name: Enable SAML support - {{ instance_name }}
  when:
    - instance.with_saml is defined
    - instance.with_saml
  block:
    - name: Update saml init script
      ansible.builtin.template:
        src: redmine/config/initializers/saml.rb.j2
        dest: '{{ redmine_app_dir }}/config/initializers/saml.rb'
        owner: '{{ redmine_user }}'
        group: '{{ redmine_group }}'
        mode: '0640'

- name: Disable SAML support - {{ instance_name }}
  ansible.builtin.file:
    path: '{{ redmine_app_dir }}/config/initializers/saml.rb'
    state: absent
  when: instance.with_saml is undefined or not instance.with_saml
