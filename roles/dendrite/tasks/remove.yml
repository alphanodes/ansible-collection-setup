---

- name: Stop Dendrite, if started
  ansible.builtin.systemd_service:
    name: dendrite
    state: stopped
    enabled: false

- name: Remove Dendrite user
  ansible.builtin.user:
    name: '{{ dendrite_service_user }}'
    state: absent
    remove: true

- name: Remove Dendrite group
  ansible.builtin.group:
    name: '{{ dendrite_service_group }}'
    state: absent

- name: Remove configuration files
  ansible.builtin.file:
    name: '{{ item }}'
    state: absent
  loop:
    - /etc/nginx/sites-available/dendrite.conf
    - /etc/nginx/sites-enabled/dendrite.conf
    - /etc/systemd/system/dendrite.service
    - /etc/systemd/system/multi-user.target.wants/dendrite.service
    - /etc/dendrite
  notify:
    - Restart nginx

- name: Remove cleaner binary
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop:
    - '{{ ddendrite_cleaner_bin }}'
    - '{{ dendrite_cleaner_src_dir }}'
    - /etc/systemd/system/matrix-room-cleaner@.service
    - /etc/systemd/system/matrix-room-cleaner@.timer

- name: Remove Dendrite files
  ansible.builtin.file:
    path: '{{ dendrite_home_dir }}'
    state: absent
