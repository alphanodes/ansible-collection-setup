---
# Reusable task for creating a MySQL/MariaDB database
#
# Usage:
#   - name: Create application database
#     ansible.builtin.include_role:
#       name: alphanodes.setup.mysql
#       tasks_from: create_database.yml
#     vars:
#       mysql_setup_db_name: myapp
#       mysql_setup_db_collation: utf8mb4_general_ci  # optional
#       mysql_setup_db_encoding: utf8mb4              # optional
#
# Required variables:
#   - mysql_setup_db_name: Database name to create
#
# Optional variables:
#   - mysql_setup_db_collation: Database collation (default: omit)
#   - mysql_setup_db_encoding: Database encoding (default: omit)

- name: Validate required variables
  ansible.builtin.assert:
    that:
      - mysql_setup_db_name is defined
      - mysql_setup_db_name | length > 0
    fail_msg: "mysql_setup_db_name is required"
    quiet: true

- name: Create database {{ mysql_setup_db_name }}
  community.mysql.mysql_db:
    login_unix_socket: "{{ mysql_socket if mysql_root_plugin == 'auth_socket' or mysql_socket_force else omit }}"
    name: '{{ mysql_setup_db_name }}'
    collation: "{{ mysql_setup_db_collation | default(omit) }}"
    encoding: "{{ mysql_setup_db_encoding | default(omit) }}"
    state: present
