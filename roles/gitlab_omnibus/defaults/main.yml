---

# only ee is support for now

gitlab_required_packages:
  # ruby just used for syntax check
  - ruby
  - gitlab-ee

gitlab_config_file: /etc/gitlab/gitlab.rb

gitlab_vhost_server: '{{ hostname | default(ansible_host) }}'

gitlab_external_url: 'https://{{ gitlab_vhost_server }}'

gitlab_email_display_name: Gitlab
gitlab_email_from: 'git@{{ gitlab_vhost_server }}'
gitlab_email_reply_to: 'noreply@{{ gitlab_vhost_server }}'

gitlab_default_theme: 2
gitlab_default_color_mode: 1

gitlab_default_projects_features:
  issues: false
  merge_requests: true
  wiki: false
  snippets: false
  builds: true
  container_registry: true

gitlab_manage_backup_path: true
gitlab_backup_path: /var/opt/gitlab/backups
gitlab_backup_pg_schema: public
gitlab_backup_archive_permissions: '0644'
gitlab_backup_keep_time: 604800

gitlab_nginx_listen_addresses:
  - '*'
  - '[::]'

gitlab_registry_nginx_listen_addresses: '{{ gitlab_nginx_listen_addresses }}'
gitlab_pages_nginx_listen_addresses: '{{ gitlab_nginx_listen_addresses }}'

# Passthrough all downloads via GitLab instead of using Redirects to Object Storage.
# ? https://docs.gitlab.com/ee/administration/object_storage.html#proxy-download
gitlab_object_store_proxy_download: true

# {
#   'provider' => 'AWS',
#   'region' => 'eu-west-1',
#   'aws_access_key_id' => 'AWS_ACCESS_KEY_ID',
#   'aws_secret_access_key' => 'AWS_SECRET_ACCESS_KEY',
#   # # The below options configure an S3 compatible host instead of AWS
#   # 'host' => 's3.amazonaws.com',
#   # 'aws_signature_version' => 4, # For creation of signed URLs. Set to 2 if provider does not support v4.
#   # 'endpoint' => 'https://s3.amazonaws.com', # default: nil - Useful for S3 compliant services such as DigitalOcean Spaces
#   # 'path_style' => false # Use 'host/bucket_name/object' instead of 'bucket_name.host/object'
# }
gitlab_object_store_connection:
  provider: AWS

gitlab_object_store_consolidated: true

gitlab_artifacts_enabled: true
gitlab_artifacts_object_store: false
gitlab_artifacts_object_store_bucket: gl-artifacts

gitlab_external_diffs_enabled: false
gitlab_external_diffs_object_store: false
gitlab_external_diffs_object_store_bucket: gl-diffs

gitlab_lfs_enabled: true
gitlab_lfs_object_store: false
gitlab_lfs_object_store_bucket: gl-lfs

gitlab_uploads_object_store: false
gitlab_uploads_object_store_bucket: gl-uploads

gitlab_packages_enabled: false
gitlab_packages_object_store: false
gitlab_packages_object_store_bucket: gl-packages

gitlab_ci_secure_files_enabled: true
gitlab_ci_secure_files_object_store: false
gitlab_ci_secure_files_object_store_bucket: gl-ci-secure-files

gitlab_dependency_proxy_enabled: true
gitlab_dependency_proxy_object_store: false
gitlab_dependency_proxy_object_store_bucket: gl-proxy

gitlab_terraform_state_enabled: false
gitlab_terraform_state_object_store: false
gitlab_terraform_state_object_store_bucket: gl-terraform

# NOTE: if you want to use object storage, use this
# gitlab_registry_storage: {}
#
# NOT USED
# gitlab_registry_object_store: false
# gitlab_registry_object_store_bucket: gl-container-registry

gitlab_pages_enabled: false
gitlab_pages_storage_path: shared/pages
gitlab_pages_local_storage: true
gitlab_pages_repository: https://gitlab.com/gitlab-org/gitlab-pages.git
gitlab_pages_path: "{{ gitlab_home }}/gitlab-pages"
gitlab_pages_secret_path: "{{ gitlab_path }}/.gitlab_pages_secret"
gitlab_pages_domain: ''
gitlab_pages_domain_ssl_cert: '{{ ssl_certs[1].name | default(ssl_certs[0].name) }}'

gitlab_pages_artifacts_server: true
gitlab_pages_object_store: false
gitlab_pages_object_store_bucket: gl-pages

gitlab_log_level: warn

gitlab_env:
  GITLAB_LOG_LEVEL: '{{ gitlab_log_level }}'

gitlab_ldap_enabled: false
gitlab_ldap_prevent_ldap_sign_in: false
gitlab_ldap_servers:
  main:
    label: 'LDAP'

gitlab_force_reconfigure: false

# https://packages.gitlab.com/gitlab/gitlab-ee/debian/ bookworm main
gitlab_apt_url: https://packages.gitlab.com/gitlab/gitlab-ee/debian/
gitlab_apt_suites: '{{ ansible_distribution_release | lower }}'
gitlab_apt_components: main
gitlab_apt_key_url: https://packages.gitlab.com/gitlab/gitlab-ee/gpgkey
