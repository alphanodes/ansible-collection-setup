---

# see https://thomas-leister.de/mailserver-debian-buster/

# DKIM - https://de.wikipedia.org/wiki/DomainKeys
# or https://www.united-domains.de/help/faq-article/was-ist-ein-dkim-eintrag

# DMARC - https://en.wikipedia.org/wiki/DMARC
# DMARC records determine what a receiving mail server should do
# when a mail fails SPF and DKIM checks (i.e., the sender is spoofed).

rspamd_packages:
  - rspamd

rspamd_user: _rspamd

rspamd_apt_url: http://rspamd.com/apt-stable/
rspamd_apt_signed_by: https://rspamd.com/apt-stable/gpg.key
rspamd_apt_suites: "{{ ansible_facts.distribution_release }}"
rspamd_apt_components: main

rspamd_enable_service: true

# see https://rspamd.com/doc/configuration/logging.html
rspamd_log_level: warning

# DKIM configuration (OPTIONAL)
# DKIM is optional - rspamd works fine without it for spam filtering
# Only configure DKIM if you want to sign outgoing emails
#
# Define centralized dkim_domains dictionary in host_vars:
#   dkim_domains:
#     alphanodes.com:
#       selector: dkim_key
#       key_size: 2048
#     example.org:
#       selector: mail
#       key_size: 4096
#
# The dkim role (dependency in meta/main.yml) will be called automatically
# and generates keys at: /var/lib/dkim/$domain/{{ selector }}.key
# Rspamd uses the $domain variable at runtime for multi-domain DKIM signing

rspamd_remove: false

rspamd_vhost_server: rspamd.local
rspamd_vhost_location: /
rspamd_vhost_letsencrypt: false
rspamd_vhost_ssl_cert: "{{ ssl_certs[0].name | default('') }}"
rspamd_vhost_letsencrypt_cert: /etc/letsencrypt/live/{{ letsencrypt_default_cert | default(ansible_host) }}/fullchain.pem
rspamd_vhost_letsencrypt_key: /etc/letsencrypt/live/{{ letsencrypt_default_cert | default(ansible_host) }}/privkey.pem
rspamd_vhost_for_zabbix: false

# nginx base auth user
rspamd_web_user: rspamd
# nginx base auth passwords (leave empty, if you do not want base auth protection)
rspamd_web_password: ''

# see https://rspamd.com/doc/configuration/redis.html
rspamd_redis_servers: "127.0.0.1"
# if you don't use the default database in Redis
# (let's say you use the database 1 instead of the default 0
rspamd_redis_db: 1

# "IP" lists can contain IPv6 and IPv4 addresses or address ranges - one entry per line.
# "From" lists contain complete sender email addresses.
# Useful for setting up exceptions for specific senders or servers.
rspamd_whitelist_ip: []
rspamd_whitelist_from: []
rspamd_blacklist_ip: []
rspamd_blacklist_from: []

# see https://rspamd.com/doc/workers/controller.html
# generate it with: rspamadm pw
# and provide it with rspamd_worker_controller_password
# rspamd_worker_controller_password:

rspamd_worker_controller_secure_ip: 127.0.0.1

# Actions - Score thresholds for spam filtering
# see https://docs.rspamd.com/configuration/metrics
rspamd_action_reject: 15  # Hard reject (bounce) at score >= 15
rspamd_action_add_header: 6  # Add X-Spam headers at score >= 6
rspamd_action_greylist: 4  # Greylist (delay) at score >= 4

# Greylisting configuration
# see https://docs.rspamd.com/modules/greylisting
rspamd_greylisting_enabled: true  # Enable greylisting (recommended for production)
rspamd_greylisting_expire: 86400  # 1 day in seconds
rspamd_greylisting_timeout: 300  # 5 minutes in seconds
rspamd_greylisting_ipv4_mask: 19  # IP netmask for greylisting
rspamd_greylisting_ipv6_mask: 64  # IPv6 netmask for greylisting

# Ratelimiting configuration
# see https://docs.rspamd.com/modules/ratelimit
rspamd_ratelimit_enabled: false  # Enable rate limiting (recommended for production)

# DNS options
rspamd_dns_enable_dnssec: true  # Enable DNSSEC validation
rspamd_local_addrs: '127.0.0.0/8, ::1'  # Local networks
rspamd_url_redirector_timeout: 10  # URL redirector timeout in seconds

# DMARC Reporting configuration
# see https://docs.rspamd.com/modules/dmarc
# Rspamd can send DMARC aggregate reports to other domains when receiving mail
rspamd_dmarc_reporting_enabled: false  # Enable DMARC reporting (requires Redis)
rspamd_dmarc_reporting_email: 'postmaster@example.com'  # From address for reports
rspamd_dmarc_reporting_domain: 'example.com'  # Domain for DMARC reports
rspamd_dmarc_reporting_org_name: 'Example Organization'  # Organization name in reports
rspamd_dmarc_reporting_helo: ''  # SMTP HELO/EHLO (optional, defaults to hostname)
rspamd_dmarc_reporting_smtp: ''  # SMTP server (optional, defaults to localhost)
rspamd_dmarc_reporting_smtp_port: 0  # SMTP port (optional, defaults to 25)
rspamd_dmarc_reporting_max_entries: 0  # Max entries per domain (optional, default 1000)
rspamd_dmarc_reporting_keys_expire: 0  # Redis keys expire time in seconds (optional, default 2d)
