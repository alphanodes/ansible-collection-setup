{#
  Custom Location Blocks
  ======================

  This template generates custom location blocks defined via instance.locations.

  Each location can have:
    - name: The location pattern (e.g., "= /index.php", "~ \.php$")
    - rewrite: Optional rewrite rule
    - action: Single nginx directive (e.g., "deny all")
    - actions: List of nginx directives
    - raw_actions: List of raw nginx directives (no semicolon added)
    - return: HTTP return code/redirect
    - with_fpm: FPM pool name for PHP processing (uses fpm.inc.j2)

  with_fpm is used for whitelist FPM patterns where only specific PHP files
  should be processed. See fpm.inc.j2 for documentation on FPM patterns.
#}
  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }

{% if instance is defined and instance.use_robots_txt_from_redmine is undefined or not instance.use_robots_txt_from_redmine %}
  location = /robots.txt {
    log_not_found off;
    access_log off;
  }
{% endif %}

  location = /humans.txt {
    log_not_found off;
    access_log off;
  }

  location ~* ^/(apple\-touch\-icon\.png|apple\-touch\-icon\-precomposed\.png) {
    log_not_found off;
    access_log off;
  }

{% if instance.locations is defined %}
{% for location in instance.locations %}

  location {{ location.name }} {
{% if location.rewrite is defined %}
    rewrite {{ location.rewrite }} permanent;
{% endif %}
{% if location.action is defined %}
    {{ location.action }};
{% endif %}
{% if location.actions is defined %}
{% for action in location.actions %}
    {{ action }};
{% endfor %}
{% endif %}
{% if location.raw_actions is defined %}
{% for raw_action in location.raw_actions %}
    {{ raw_action }}
{% endfor %}
{% endif %}
{% if location.return is defined %}
    return {{ location.return }};
{% endif %}
{% if location.with_fpm is defined and location.with_fpm %}
{% set fpm_pool = location.with_fpm %}
{% include 'includes/fpm.inc.j2' %}

{% endif %}
  }
{% endfor %}
{% endif %}
