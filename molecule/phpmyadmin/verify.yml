---
- name: Verify
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Verify PHP CLI is installed
      ansible.builtin.command: php --version
      changed_when: false
      register: php_output
      failed_when: "'PHP 8.2' not in php_output.stdout"

    - name: Verify MySQL client is installed
      ansible.builtin.command: mysql --version
      changed_when: false
      register: mysql_output
      failed_when: mysql_output.rc != 0

    - name: Verify PHP-FPM pool config exists
      ansible.builtin.stat:
        path: /etc/php/8.2/fpm/pool.d/phpmyadmin.conf
      register: fpm_pool_config
      failed_when: not fpm_pool_config.stat.exists

    - name: Display verification success
      ansible.builtin.debug:
        msg: "phpMyAdmin dependencies verification completed successfully"
