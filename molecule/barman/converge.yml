---
- name: Converge
  hosts: all
  remote_user: root

  pre_tasks:
    - name: Update apt cache.
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 600
      changed_when: false

  vars:
    # Test configuration for Barman
    barman_task: setup
    barman_log_level: DEBUG

    # Use dynamically generated SSH key (now in files/ directory)
    barman_private_key: barman_id_rsa

    # Simplified test configuration without database servers to avoid SSH dependencies
    barman_db_servers: []

    barman_postgresql_password: test_password

    backup_sets:
      - name: etc
        src: /etc
      - name: root
        src: /root


  roles:
    - role: alphanodes.setup.barman
